<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Battery Voltage Calculator 🔋</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="app">
    <header class="header">
      <div class="container">
        <h1>🔋 Battery Calculator</h1>
        <p class="subtitle">Convert your scooter's voltage to percentage with smart insights</p>
      </div>
    </header>

    <main class="main">
      <div class="container">
        <div class="main-content">
          <div class="calculator-card">
            <!-- Battery Type Selection -->
            <div class="input-group">
              <label for="batteryType">Battery Type</label>
              <div class="select-wrapper">
                <select id="batteryType">
                  <option value="36">36V Battery</option>
                  <option value="48">48V Battery</option>
                  <option value="52">52V Battery</option>
                  <option value="60">60V Battery</option>
                  <option value="72" selected>72V Battery</option>
                </select>
              </div>
            </div>

            <!-- Voltage Input -->
            <div class="input-group">
              <label for="voltageInput">Current Voltage</label>
              <div class="input-wrapper">
                <input type="number" id="voltageInput" step="0.1" placeholder="e.g. 79.2" />
                <span class="unit">V</span>
                <button type="button" class="camera-btn" id="cameraBtn" onclick="openCamera()"
                  title="Scan voltage from multimeter">
                  📷
                </button>
              </div>
            </div>

            <!-- Hidden camera elements -->
            <div id="cameraModal" class="camera-modal">
              <div class="camera-content">
                <div class="camera-header">
                  <h3>📷 Scan Multimeter Display</h3>
                  <button class="close-btn" onclick="closeCamera()">✕</button>
                </div>
                <div class="camera-preview">
                  <video id="cameraVideo" autoplay playsinline></video>
                  <canvas id="captureCanvas" style="display: none;"></canvas>
                </div>
                <div class="camera-instructions">
                  <p>Position your multimeter display in the camera view and tap capture</p>
                </div>
                <div class="camera-controls">
                  <button class="capture-btn" onclick="captureAndAnalyze()">📸 Capture & Analyze</button>
                  <button class="cancel-btn" onclick="closeCamera()">Cancel</button>
                </div>
                <div id="scanResult" class="scan-result"></div>
              </div>
            </div>

            <!-- Battery Display -->
            <div class="battery-section">
              <div class="battery-container">
                <div class="battery">
                  <div class="battery-fill" id="batteryFill">
                    <span id="batteryPercent">0%</span>
                  </div>
                  <div class="battery-terminal"></div>
                </div>
                <div class="battery-info">
                  <div class="voltage-display" id="voltageDisplay">-- V</div>
                  <div class="status-text" id="statusText">Enter voltage to start</div>
                </div>
              </div>
            </div>

            <!-- Advanced Settings -->
            <div class="advanced-section">
              <button class="advanced-toggle" id="advancedToggle" onclick="toggleAdvanced()">
                <span class="toggle-icon">⚙️</span>
                <span class="toggle-text">Advanced Settings</span>
                <span class="toggle-arrow">▼</span>
              </button>

              <div class="advanced-panel" id="advancedPanel">
                <div class="advanced-grid">
                  <div class="input-group">
                    <label for="cellMax">Max Cell Voltage</label>
                    <input type="number" id="cellMax" value="4.2" step="0.01" />
                  </div>
                  <div class="input-group">
                    <label for="cellNominal">Nominal Cell Voltage</label>
                    <input type="number" id="cellNominal" value="3.7" step="0.01" />
                  </div>
                  <div class="input-group">
                    <label for="cellMin">Min Cell Voltage</label>
                    <input type="number" id="cellMin" value="3.0" step="0.01" />
                  </div>
                  <div class="input-group">
                    <label for="controllerCutoff">Controller Cutoff (V)</label>
                    <input type="number" id="controllerCutoff" value="0" step="0.1" placeholder="e.g. 60.0" />
                    <small style="color: #a0aec0; font-size: 0.8rem; margin-top: 0.25rem; display: block;">
                      Voltage when scooter stops (for accurate % calculation)
                    </small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Tips and Warnings -->
            <div class="tips-section">
              <div class="tip-card" id="tipCard">
                <div class="tip-icon" id="tipIcon">💡</div>
                <div class="tip-content">
                  <div class="tip-title" id="tipTitle">Ready to calculate</div>
                  <div class="tip-text" id="tipText">Enter your battery voltage above to get started</div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
  </div>

  <!-- Quick Reference -->
  <div class="reference-card">
    <h3>Quick Reference</h3>
    <div class="reference-grid" id="referenceGrid">
      <!-- Will be populated by JavaScript -->
    </div>
  </div>

  <!-- Battery & Scooter Tips Guide -->
  <div class="guide-card">
    <h3>Battery & Scooter Tips Guide</h3>
    <div class="guide">
      <details class="guide-item">
        <summary>Overcharge scenarios</summary>
        <div class="guide-content">
          <ul>
            <li><strong>Slightly overcharged</strong> (≤ about +0.05V per cell, or ≤ ~2% above pack full): often
              surface charge right after charging; let the pack rest 15–30 min and it should settle.
              Calibrate/verify charger if this happens often.</li>
            <li><strong>Over full charge</strong> (~+2–10% over expected full, or ~+0.05–0.10V per cell): unplug
              immediately; let rest; avoid hard riding until it settles. Check charger output and BMS balancing.
            </li>
            <li><strong>Dangerously overcharged</strong> (> ~+0.10V per cell, typically > 4.30V/cell): stop
              using;
              DO NOT charge; move to a non-flammable area; inspect wiring/charger and seek service.</li>
          </ul>
          <p>Tip: Use only the manufacturer-approved charger. Lithium-ion uses CC/CV charging and should not be
            pushed above the rated max (typically 4.20V/cell).</p>
        </div>
      </details>

      <details class="guide-item">
        <summary>Undercharge / discharge scenarios</summary>
        <div class="guide-content">
          <ul>
            <li><strong>Healthy low</strong> (~40–60%): fine for storage; normal for day-to-day use.</li>
            <li><strong>Low</strong> (~20–40%): rideable with reduced performance; plan to charge soon.</li>
            <li><strong>Very low</strong> (~10–20%): voltage sag increases under load; avoid steep hills; charge
              soon.</li>
            <li><strong>Near cutoff</strong> (0–10%): scooter may shut off suddenly under load; charge now.</li>
            <li><strong>Deeply discharged</strong> (roughly &lt; ~3.0V/cell equivalent; severe &lt; ~2.5V/cell):
              cells may be damaged. Do not continue riding. Charging could be unsafe if cells are severely
              depleted—seek professional advice.</li>
          </ul>
          <p>Set <strong>Controller Cutoff</strong> in Advanced if your scooter shuts off early. It does not
            change the actual voltage—only the 0% baseline for more accurate %.</p>
        </div>
      </details>

      <details class="guide-item">
        <summary>Temperature and charging</summary>
        <div class="guide-content">
          <ul>
            <li><strong>Best charging temp</strong>: about 10–30°C. Avoid charging below 0°C (risk of lithium
              plating) or above ~45°C (accelerated degradation).</li>
            <li><strong>Riding in cold</strong>: expect less range and more voltage sag. Warm the pack indoors
              before charging.</li>
            <li><strong>Heat</strong>: avoid leaving the scooter in hot cars or direct sun; high heat shortens
              lifespan.</li>
          </ul>
        </div>
      </details>

      <details class="guide-item">
        <summary>Storage</summary>
        <div class="guide-content">
          <ul>
            <li><strong>State of charge</strong>: store around 40–60% and in a cool, dry place (~10–25°C).</li>
            <li><strong>Periodic checks</strong>: top up every 1–2 months if it drifts low; never store
              long-term
              at 0% or 100%.</li>
          </ul>
        </div>
      </details>

      <details class="guide-item">
        <summary>Measuring and interpreting voltage</summary>
        <div class="guide-content">
          <ul>
            <li><strong>Measure at rest</strong>: after charging/riding, let the pack rest 15–30 min to reduce
              surface charge or rebound effects.</li>
            <li><strong>Voltage sag</strong>: under load, voltage dips; this is normal. The % here assumes
              resting
              voltage.</li>
          </ul>
        </div>
      </details>

      <details class="guide-item">
        <summary>Charger and BMS tips</summary>
        <div class="guide-content">
          <ul>
            <li>Use the correct charger and verify its output voltage matches your pack.</li>
            <li>Occasionally charge to 100% and let rest so the BMS can balance cells. For longevity, daily
              charging to ~80–90% is common.</li>
            <li>Do not leave on the charger for days; unplug after it reaches full.</li>
          </ul>
        </div>
      </details>

      <details class="guide-item">
        <summary>Safety and damage checks</summary>
        <div class="guide-content">
          <ul>
            <li>Stop using the battery if you notice <strong>swelling, hissing, strong odor, smoke, or unusual
                heat</strong>. Isolate in a non-flammable area and seek service.</li>
            <li>If the scooter or battery gets wet, <strong>do not charge</strong> until fully dry. Water can
              corrode connectors and cause shorts.</li>
            <li>Transport and store away from flammable materials. Never puncture or crush cells.</li>
          </ul>
        </div>
      </details>
    </div>
  </div>

  <!-- Jumpstart & BMS Troubleshooting Guide -->
  <div class="guide-card" id="jumpstart-guide">
    <h3>🔧 Jumpstart & BMS Troubleshooting Guide</h3>
    <div class="guide">
      <details class="guide-item">
        <summary>Battery Protection & BMS Sleep Mode</summary>
        <div class="guide-content">
          <p><strong>When your battery shows very low voltage, it could be:</strong></p>
          <ul>
            <li><strong>BMS Protection</strong> - Battery Management System has cut off power to protect cells</li>
            <li><strong>Sleep Mode</strong> - BMS has entered low-power mode to prevent further discharge</li>
            <li><strong>Cell Imbalance</strong> - One or more cells are severely discharged while others are fine</li>
            <li><strong>BMS Failure</strong> - The protection circuit itself has failed</li>
            <li><strong>Dead Pack</strong> - Cells are permanently damaged and unsafe</li>
          </ul>
        </div>
      </details>

      <details class="guide-item">
        <summary>How to Check if Battery is Safe to Jumpstart</summary>
        <div class="guide-content">
          <p><strong>Before attempting any recovery:</strong></p>
          <ul>
            <li><strong>Check for physical damage</strong> - swelling, cracks, leaks, or heat damage</li>
            <li><strong>Measure individual cell voltages</strong> - if you have access to the BMS balance connector</li>
            <li><strong>Check for shorts</strong> - use a multimeter to test for continuity between positive and
              negative</li>
            <li><strong>Look for corrosion</strong> - on terminals, connectors, and wiring</li>
            <li><strong>Check BMS status</strong> - some BMS units have status LEDs or can be checked with a BMS app
            </li>
          </ul>
          <p><strong>⚠️ DO NOT attempt recovery if:</strong></p>
          <ul>
            <li>Any cell is below 2.0V (severely damaged)</li>
            <li>Battery is swollen or physically damaged</li>
            <li>You smell any chemical odors</li>
            <li>Battery gets hot during charging attempts</li>
          </ul>
        </div>
      </details>

      <details class="guide-item">
        <summary>Jumpstarting Methods (Advanced Users Only)</summary>
        <div class="guide-content">
          <p><strong>⚠️ WARNING: These methods can be dangerous. Only attempt if you understand the risks.</strong></p>

          <h4>Method 1: BMS Wake-up (Safest)</h4>
          <ul>
            <li>Connect a <strong>low-current charger</strong> (0.1-0.5A) for 5-10 minutes</li>
            <li>If BMS wakes up, switch to normal charging</li>
            <li>Monitor temperature and voltage closely</li>
          </ul>

          <h4>Method 2: Parallel Charging (Advanced)</h4>
          <ul>
            <li>Connect a <strong>good battery in parallel</strong> (same voltage)</li>
            <li>Let them balance for 30-60 minutes</li>
            <li>Remove parallel connection and try normal charging</li>
            <li><strong>Only if both batteries are the same voltage!</strong></li>
          </ul>

          <h4>Method 3: Direct Cell Charging (Expert Only)</h4>
          <ul>
            <li>Access individual cells through BMS balance connector</li>
            <li>Charge each cell individually to 3.0V minimum</li>
            <li>Use a <strong>very low current</strong> (0.1A max)</li>
            <li><strong>Extremely dangerous - not recommended for beginners</strong></li>
          </ul>
        </div>
      </details>

      <details class="guide-item">
        <summary>BMS Troubleshooting</summary>
        <div class="guide-content">
          <h4>Common BMS Issues:</h4>
          <ul>
            <li><strong>Over-discharge protection</strong> - BMS cuts off at low voltage to protect cells</li>
            <li><strong>Over-current protection</strong> - BMS cuts off during high current draw</li>
            <li><strong>Temperature protection</strong> - BMS cuts off if too hot or too cold</li>
            <li><strong>Cell imbalance</strong> - BMS prevents charging if cells are too different</li>
            <li><strong>Communication error</strong> - BMS can't communicate with controller</li>
          </ul>

          <h4>BMS Reset Methods:</h4>
          <ul>
            <li><strong>Disconnect and reconnect</strong> - unplug BMS for 30 seconds</li>
            <li><strong>Charge trigger</strong> - connect charger to wake up BMS</li>
            <li><strong>Load trigger</strong> - connect a small load (like a light bulb) to activate BMS</li>
            <li><strong>BMS app</strong> - some BMS units can be reset via smartphone app</li>
          </ul>
        </div>
      </details>

      <details class="guide-item">
        <summary>When to Give Up - Battery is Toast</summary>
        <div class="guide-content">
          <p><strong>Your battery is likely beyond recovery if:</strong></p>
          <ul>
            <li>Voltage has been below 2.0V per cell for weeks/months</li>
            <li>Cells are severely swollen or physically damaged</li>
            <li>BMS shows error codes that won't clear</li>
            <li>Battery gets hot during any charging attempt</li>
            <li>Multiple jumpstart attempts have failed</li>
            <li>You smell any chemical odors (electrolyte leakage)</li>
          </ul>

          <p><strong>Disposal:</strong></p>
          <ul>
            <li>Take to a <strong>proper battery recycling center</strong></li>
            <li>Never throw lithium batteries in regular trash</li>
            <li>Some electronics stores accept them for recycling</li>
            <li>Check local regulations for lithium battery disposal</li>
          </ul>
        </div>
      </details>

      <details class="guide-item">
        <summary>Prevention - Keep Your Battery Healthy</summary>
        <div class="guide-content">
          <ul>
            <li><strong>Never let voltage drop below 3.0V per cell</strong> (use this calculator to monitor)</li>
            <li><strong>Charge regularly</strong> - don't let it sit discharged for weeks</li>
            <li><strong>Store at 40-60% charge</strong> in a cool, dry place</li>
            <li><strong>Use the correct charger</strong> - wrong voltage can damage BMS</li>
            <li><strong>Check connections regularly</strong> - loose connections cause voltage drops</li>
            <li><strong>Balance charge monthly</strong> - charge to 100% occasionally to let BMS balance cells</li>
          </ul>
        </div>
      </details>
    </div>
  </div>
  </div>
  </div>
  </main>
  </div>

  <script src="script.js"></script>
</body>

</html>
